# Kite Simulator V8 ü™Å

Simulateur de cerf-volant delta bas√© sur la physique avec architecture **Entity-Component-System (ECS) pure**.

[![TypeScript](https://img.shields.io/badge/TypeScript-5.7-blue.svg)](https://www.typescriptlang.org/)
[![Three.js](https://img.shields.io/badge/Three.js-0.171-green.svg)](https://threejs.org/)
[![Vite](https://img.shields.io/badge/Vite-6.0-purple.svg)](https://vitejs.dev/)
[![ECS](https://img.shields.io/badge/Architecture-ECS%20Pure-orange.svg)]()

---

## üéØ Vue d'Ensemble

Simulateur de cerf-volant delta utilisant une **simulation physique r√©aliste** :
- **A√©rodynamique** : Mod√®le lift/drag bas√© sur l'angle d'attaque
- **Bridage** : Syst√®me de 4 brides avec contraintes PBD (Position-Based Dynamics)
- **Lignes de contr√¥le** : Physique des lignes avec tension, √©longation, amortissement
- **Vent apparent** : Calcul r√©aliste du vent relatif
- **Sph√®re de vol** : Contrainte spatiale bas√©e sur longueur lignes + brides

**Stack Technique** : TypeScript + Three.js + Vite

**Architecture** : ECS 100% pure (0% code OO legacy)

---

## üöÄ D√©marrage Rapide

### Pr√©requis

- Node.js 18+ et npm
- Git

### Installation

```bash
# Cloner le d√©p√¥t
git clone <repository-url>
cd kite_v5

# Installer les d√©pendances
npm install

# Lancer le serveur de d√©veloppement
npm run dev
```

Le simulateur sera accessible sur **http://localhost:3001**

### Commandes Disponibles

```bash
# D√©veloppement
npm run dev              # Serveur Vite (port 3001)

# Build
npm run build            # Build production
npm run preview          # Preview du build

# Qualit√© de Code
npm run type-check       # V√©rification TypeScript
npm run lint             # ESLint
npm run lint:fix         # Auto-fix ESLint

# Tests
npx vitest run           # Lancer tous les tests
npx vitest               # Mode watch
npx vitest run --coverage # Avec couverture
npm run test-ecs         # Tests d'int√©gration ECS (tsx)
```

---

## üìÅ Structure du Projet

```
kite_v5/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.ts                      # Point d'entr√©e
‚îÇ   ‚îî‚îÄ‚îÄ ecs/                         # Architecture ECS
‚îÇ       ‚îú‚îÄ‚îÄ SimulationApp.ts         # Application principale
‚îÇ       ‚îú‚îÄ‚îÄ base/                    # Classes de base ECS
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Entity.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Component.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ BaseSystem.ts
‚îÇ       ‚îú‚îÄ‚îÄ components/              # Composants (donn√©es)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ TransformComponent.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ PhysicsComponent.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ GeometryComponent.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ KiteComponent.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ LineComponent.ts
‚îÇ       ‚îú‚îÄ‚îÄ entities/                # Factories d'entit√©s
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ EntityManager.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ EntityManager.optimized.ts  # ‚ö° Version optimis√©e
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ KiteEntityFactory.pure.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ PilotEntityFactory.ts
‚îÇ       ‚îú‚îÄ‚îÄ systems/                 # Syst√®mes (logique)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ KitePhysicsSystem.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ PureConstraintSolver.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ PureLineSystem.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ PureBridleSystem.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ GeometryRenderSystem.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ RenderSystem.ts
‚îÇ       ‚îú‚îÄ‚îÄ config/                  # Configuration
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ SimulationConfig.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ PhysicsConstants.ts
‚îÇ       ‚îú‚îÄ‚îÄ ui/                      # Interface utilisateur
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ UIManager.ts
‚îÇ       ‚îî‚îÄ‚îÄ utils/                   # Utilitaires
‚îú‚îÄ‚îÄ test/                            # Tests unitaires
‚îÇ   ‚îú‚îÄ‚îÄ EntityManager.archetype.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ test_ecs_integration.ts
‚îú‚îÄ‚îÄ external/                        # R√©f√©rences externes
‚îÇ   ‚îî‚îÄ‚îÄ nasa-bga/                    # Mod√®les NASA (r√©f√©rence)
‚îî‚îÄ‚îÄ docs/                            # Documentation
    ‚îú‚îÄ‚îÄ MIGRATION_ECS_PROGRESS.md
    ‚îú‚îÄ‚îÄ MIGRATION_SUMMARY_2025-10-15.md
    ‚îú‚îÄ‚îÄ TESTS_AND_PERFORMANCE.md
    ‚îú‚îÄ‚îÄ NEXT_STEPS.md
    ‚îî‚îÄ‚îÄ PHYSICS_MODEL.md
```

---

## üèóÔ∏è Architecture ECS

### Principes

L'architecture **Entity-Component-System** s√©pare strictement :

1. **Entities** (Entit√©s) : Conteneurs uniques identifi√©s par ID
2. **Components** (Composants) : Donn√©es pures sans logique
3. **Systems** (Syst√®mes) : Logique m√©tier qui manipule les composants

### Flux de Donn√©es

```mermaid
graph TD
    A[Factories] -->|Cr√©ent| B[Entities + Components]
    B -->|Enregistr√©es dans| C[EntityManager]
    C -->|Queries par| D[Systems]
    D -->|Manipulent| E[Components]
    E -->|Rendu via| F[RenderSystem]
```

### Exemple : Cr√©ation d'une Entit√© Kite

```typescript
// 1. Factory cr√©e l'entit√© avec composants
const kiteEntity = KiteEntityFactory.create(controlBarPosition);

// 2. Enregistrement dans EntityManager
entityManager.registerEntity(kiteEntity);

// 3. Syst√®mes acc√®dent via queries
const kites = entityManager.getEntitiesByArchetype(['transform', 'physics', 'kite']);

// 4. Manipulation des composants
kites.forEach(entity => {
  const physics = entity.getComponent<PhysicsComponent>('physics');
  const transform = entity.getComponent<TransformComponent>('transform');
  
  // Calcul physique...
  physics.velocity.add(acceleration.multiplyScalar(deltaTime));
  transform.position.add(physics.velocity.clone().multiplyScalar(deltaTime));
});
```

---

## üé® Composants Principaux

| Composant | Description | Donn√©es Cl√©s |
|-----------|-------------|--------------|
| `TransformComponent` | Position/rotation dans l'espace | `position`, `rotation`, `quaternion` |
| `PhysicsComponent` | Propri√©t√©s physiques | `mass`, `velocity`, `acceleration`, `forces` |
| `GeometryComponent` | G√©om√©trie pure (points/connexions) | `points`, `connections`, `surfaces` |
| `MeshComponent` | Objet Three.js pour rendu | `object3D`, `material` |
| `KiteComponent` | Donn√©es sp√©cifiques au kite | `area`, `wingspan`, `chordLength` |
| `LineComponent` | Configuration des lignes | `restLength`, `stiffness`, `damping` |
| `BridleComponent` | Configuration des brides | `attachmentPoints`, `lengths` |
| `AerodynamicsComponent` | Coefficients a√©rodynamiques | `liftCoeff`, `dragCoeff`, `angleOfAttack` |

---

## ‚ö° Syst√®mes Principaux

| Syst√®me | Responsabilit√© | Fr√©quence |
|---------|----------------|-----------|
| `KitePhysicsSystem` | Orchestration physique du kite | Chaque frame |
| `PureConstraintSolver` | Contraintes PBD (lignes, brides, sol) | Chaque frame |
| `PureLineSystem` | √âtat et tensions des lignes | Chaque frame |
| `PureBridleSystem` | √âtat et tensions des brides | Chaque frame |
| `AerodynamicsCalculator` | Forces a√©rodynamiques | Chaque frame |
| `WindSimulator` | Simulation vent turbulent | Chaque frame |
| `GeometryRenderSystem` | Conversion g√©om√©trie ‚Üí Three.js | Init + updates |
| `RenderSystem` | Rendu visuel Three.js | Chaque frame |
| `InputSystem` | Gestion inputs utilisateur | Chaque frame |
| `LoggingSystem` | Logging s√©lectif et m√©triques | Chaque frame |

---

## üß™ Tests

### Lancer les Tests

```bash
# Tous les tests
npx vitest run

# Mode watch (relance automatiquement)
npx vitest

# Avec couverture de code
npx vitest run --coverage

# Tests sp√©cifiques
npx vitest run test/EntityManager.archetype.test.ts
```

### Couverture Actuelle

- ‚úÖ **EntityManager** : 25 tests (archetype queries, cache, index)
- ‚úÖ **Tests d'int√©gration** : 3 tests (cr√©ation entit√©s, physique de base)
- üîÑ **Syst√®mes ECS** : En cours (PureConstraintSolver, PureLineSystem, etc.)

**Objectif** : >70% couverture pour syst√®mes critiques

---

## üìä Optimisations de Performance

### EntityManager Optimis√©

Utiliser `EntityManager.optimized.ts` pour de meilleures performances :

```typescript
import { EntityManager } from '@entities/EntityManager.optimized';

const entityManager = new EntityManager();

// Query archetype optimis√©e avec cache
const renderables = entityManager.getEntitiesByArchetype([
  'transform', 'mesh', 'visual'
]);

// Statistiques de performance
const stats = entityManager.getStats();
console.log(`Queries cach√©es: ${stats.cachedQueries}`);
console.log(`Entit√©s actives: ${stats.activeEntities}`);
```

**Am√©lioration** :
- ‚úÖ **4-5x plus rapide** pour queries simples
- ‚úÖ **100x plus rapide** pour queries cach√©es (r√©p√©t√©es)
- ‚úÖ Index invers√© par composant pour acc√®s O(1)

Voir **[TESTS_AND_PERFORMANCE.md](./TESTS_AND_PERFORMANCE.md)** pour plus de d√©tails.

---

## üìñ Documentation

| Document | Description |
|----------|-------------|
| [PHYSICS_MODEL.md](./PHYSICS_MODEL.md) | Mod√®le physique d√©taill√© |
| [MIGRATION_ECS_PROGRESS.md](./MIGRATION_ECS_PROGRESS.md) | Historique migration ECS |
| [MIGRATION_SUMMARY_2025-10-15.md](./MIGRATION_SUMMARY_2025-10-15.md) | R√©sum√© complet migration |
| [TESTS_AND_PERFORMANCE.md](./TESTS_AND_PERFORMANCE.md) | Guide tests & performance |
| [NEXT_STEPS.md](./NEXT_STEPS.md) | Prochaines √©tapes |
| [.github/copilot-instructions.md](./.github/copilot-instructions.md) | Guide d√©veloppeur |

---

## üõ†Ô∏è D√©veloppement

### Ajouter un Nouveau Composant

```typescript
// src/ecs/components/MyComponent.ts
import { Component } from '@base/Component';

export class MyComponent implements Component {
  readonly type = 'my-component';
  
  // Donn√©es uniquement, pas de logique !
  public value: number;
  
  constructor(value: number = 0) {
    this.value = value;
  }
}
```

### Ajouter un Nouveau Syst√®me

```typescript
// src/ecs/systems/MySystem.ts
import { BaseSimulationSystem } from '@base/BaseSimulationSystem';
import { SimulationContext } from '@types/PhysicsTypes';

export class MySystem extends BaseSimulationSystem {
  initialize(): void {
    // Initialisation du syst√®me
  }

  update(context: SimulationContext): void {
    // Logique ex√©cut√©e chaque frame
    const entities = this.entityManager.getEntitiesByArchetype(['my-component']);
    
    entities.forEach(entity => {
      const component = entity.getComponent<MyComponent>('my-component');
      // Traitement...
    });
  }

  reset(): void {
    // R√©initialisation du syst√®me
  }

  dispose(): void {
    // Nettoyage des ressources
  }
}
```

### Alias de Chemins

Toujours utiliser les alias d√©finis dans `tsconfig.json` :

```typescript
// ‚úÖ BON
import { Entity } from '@base/Entity';
import { TransformComponent } from '@components/TransformComponent';
import { CONFIG } from '@config/SimulationConfig';

// ‚ùå MAUVAIS
import { Entity } from '../../../base/Entity';
```

**Alias disponibles** :
- `@ecs` ‚Üí `src/ecs`
- `@base` ‚Üí `src/ecs/base`
- `@components` ‚Üí `src/ecs/components`
- `@systems` ‚Üí `src/ecs/systems`
- `@entities` ‚Üí `src/ecs/entities`
- `@types` ou `@mytypes` ‚Üí `src/ecs/types`
- `@config` ‚Üí `src/ecs/config`
- `@utils` ‚Üí `src/ecs/utils`
- `@ui` ‚Üí `src/ecs/ui`
- `@rendering` ‚Üí `src/ecs/rendering`

---

## ü§ù Contribution

### Workflow Git

```bash
# Cr√©er une branche feature
git checkout -b feature/ma-fonctionnalite

# Faire vos changements
npm run type-check  # V√©rifier TypeScript
npm run lint:fix    # Fix ESLint
npx vitest run      # Lancer tests

# Commit
git add .
git commit -m "feat: description de la fonctionnalit√©"

# Push et cr√©er PR
git push origin feature/ma-fonctionnalite
```

### R√®gles de Code

1. **Code Propre** : Pas de rustines, toujours refactoriser proprement
2. **ECS Pur** : Composants = donn√©es, Syst√®mes = logique
3. **Types Stricts** : Pas d'`any`, types explicites partout
4. **Nommage Clair** : `calculateApparentWind`, pas `calcWind`
5. **Fonctions Courtes** : Max 20 lignes quand possible
6. **Tests** : Ajouter tests pour nouvelles fonctionnalit√©s
7. **Documentation** : Commenter la physique/a√©rodynamique complexe

Voir [.github/copilot-instructions.md](./.github/copilot-instructions.md) pour guide complet.

---

## üìà M√©triques Projet

### Code Quality
- ‚úÖ **0 erreur TypeScript**
- ‚úÖ **Architecture ECS 100% pure**
- üéØ **>80% test coverage** (objectif)

### Performance
- üéØ **60 FPS stable** avec 500+ entit√©s
- üéØ **<10ms/frame** pour physique
- ‚ö° **Queries optimis√©es** (cache + index)

---

## üìù Licence

[√Ä d√©finir]

---

## üôè Remerciements

- **NASA BGA** : Mod√®les de r√©f√©rence pour a√©rodynamique
- **Three.js** : Rendu 3D
- **Vite** : Build tooling ultra-rapide

---

## üìû Contact

Pour questions ou suggestions :
- Cr√©er une [issue GitHub](https://github.com/<repo>/issues)
- Consulter la documentation dans `/docs`

---

**Derni√®re mise √† jour** : 15 octobre 2025  
**Version** : 8.0.0-beta  
**Statut** : Migration ECS ‚úÖ Compl√®te
